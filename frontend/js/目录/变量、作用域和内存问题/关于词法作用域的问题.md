# 关于词法作用域的问题

## 别忘了，JavaScript函数都是在定义它的环境中执行的。在函数中，要确定变量来自何方，可按从内到外的顺序依次在包含它的函数中搜索。


### **问**: 你说词法作用域决定了变量是在哪里定义的，这是什么意思？
**答**: 所谓词法作用域，指的是JavaScript的作用域规则完全基于代码的结构，而不是一些动态的运行阶段属性。这意味着只需查看代码的结构，就能确定变量是在什么地方定义的。另外别忘了，在JavaScript中，只有函数会引入新的作用域。因此，对于在函数中引用的变量，要确定它是在哪里定义的，可从最里面（当前函数）开始依次向最外面进行查找，直到找到它为止。如果在这些函数中都找不到它，则它要么是全局的，要么未定义。

### **问**: 在函数被嵌套很多层的情况下，环境的工作原理是什么呢？
**答**: 前面解释环境时，简化了环境的表示，实际上，你可以认为每个嵌套函数都有自己的小环境，其中包含它自己的变量。这样将形成一个环境链，从内到外依次为各个嵌套函数的环境。因此，在环境中查找变量时，你将从最近的环境着手，沿环境链不断往下查找，直到找到变量为止。如果在环境链中没有找到，再在全局环境中查找。

### **问**: 为何说词法作用域和函数环境是好东西？我原本以为前述示例代码的结果为“Oh, don’t you worry about it, I’m GLOBAL”。在我看来，这更合乎情理。正确的答案令人迷惑，也有悖于直觉。

**答**: 我们明白你为何这么想，但词法作用域的优点是，总是可以通过查看代码来确定变量是在哪里定义的，进而确定它的值。正如你看到的，即便在你返回函数并过后在定义函数的作用域外面调用它时，情况亦如此。词法作用域和函数环境是好东西的另一个原因是，使用这种功能可做很多事情，稍后进行介绍。

### **问**: 形参变量是否也包含在环境中？
**答**: 是的。前面说过，可将形参视为函数的局部变量，因此它们也包含在环境中。

### **问**: 我需要详细了解环境的工作原理吗？
**答**: 不需要。你只需明白有关JavaScript变量的词法作用域规则即可，我们在前面已经介绍过。你现在已经知道，从函数返回的函数携带了其周边环境。